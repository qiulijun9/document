在全局上下文中调用函数时，会创建一个本地上下文，在函数 return 或者遇到了}时，也就是函数执行完时，本地执行上下文消失。变量也被销毁

当一个函数创建并传递，或从另一个函数返回时，它就会形成一个闭包，闭包中保存的是函数声明时作用域内的所有变量。 所以在函数外面能访问到函数中的变量。

# 闭包

闭包：能够读取其他函数内部变量的函数。闭包只能取得函数中任何变量的最后一个值

```
function fn1() {
	var name = 'iceman';
	function fn2() {
		console.log(name);
	}
	return fn2;
}
var fn3 = fn1();
fn3();
```

# 产生闭包

在一个函数内部创建另一个函数时会形成闭包

# 闭包作用

1. 读取函数内部的变量
2. 这些变量可以一直保存在内存中，不会在调用后清除

# 闭包的缺点

1. 闭包的缺点就是导致原有作用域链不释放，常驻内存会增大内存使用量，并且使用不当很容易造成内存泄露。
   解决方法是在退出函数之前，将不使用的局部变量全部删除或者置为 null
2. 闭包会在父函数外面，改变父函数内部的值。不要随便改变父函数内部的变量值。

# 优点

1. 长期保存在内存中
2. 避免全局变量的污染
3. 定义私有方法和变量

# 闭包的应用

1. 定义模块，将模块的方法暴露给外部
2. 立即执行函数
3. setTimeout,事件监听，ajax 请求中使用的回调函数
4. 使用闭包待代替全局变量

react-hooks 出产生大量闭包
useEffect ，useState 等依赖闭包，根据闭包特性，state 模块中的 state 变量也会永久存在，当 useState 执行时，访问了 state,就产生了闭包。
解决过时闭包的方法是正确设置依赖
