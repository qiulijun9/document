# http 特点

1. 灵活可扩展：语义自由，传输形式多样
2. 可靠传输
3. 请求-应答
4. 无状态
5. 明文传输
6. 对头阻塞

# http1.0

http1.0 规定浏览器与服务器只保持短暂的连接
连接无法复用，每次请求都需要经历三次握手和慢启动
head of line blocking 会导致带宽无法被充分利用，后续健康请求被阻塞

# http1.1

http1.1 和 http1.0 的区别：

1. 缓存处理，多了（entity tag,If-Unmodified-since,If-Match,If-None-Match）等缓存信息
2. 宽带优化及网络连接的使用：http1.0 存在一些浪费带宽的现象，例如客户端只是需要某个对象的一部分，而服务器却将整个对象送过来了，并且不支持断点续传功能允许只请求资源的某个部分，返回码是 206
3. 错误通知的管理，在 HTTP1.1 中新增了 24 个错误状态响应码，如 409（Conflict）表示请求的资源与资源的当前状态发生冲突；410（Gone）表示服务器上的某个资源被永久性的删除。
4. Host 头处理，请求消息和响应消息中都支持 Host 头域，且请求消息中如果没有 Host 头域，会报 400 错
5. 长连接：默认开启 connection：keep-alive，弥补了 http1.0 每次请求都要建立连接的缺点

# http2.0

HTTP2.0 和 HTTP1.X 相比的新特性：

1. 支持二进制传送，实现方便且健壮。
2. 支持多路复用，即连接共享，可以发送多个请求
3. 头部压缩，采用 HPACK 压缩算法，压缩头部，减小传输的体积
4. 支持服务端推送，是指把客户端所需要的 css,js，img 资源伴随着 index.html 一起发送到客户端，客户端从缓存中取

https://mp.weixin.qq.com/s/7tKgSmkMWHdIyvrTWJE8sg

# http3.0

http3.0 有望引入谷歌主导开发的 QUIC 协议（快速 UDP 网络连接）。QUIC 放弃了 TCP，而使用了同级的 UDP 协议做传输层。在 UDP 的基础上增加了很多功能，比如多路复用，流量控制，重传等。

避免对头阻塞：采用的传输单元是数据包, 不同流之间的数据传输实现了互不干扰，在包阻塞时，并不会对其他包的传输产生影响。

快速重启会话：普通的 tcp 连接必须重新创建，而 QUIC 用特有的 UUID 标记每次连接，在网络环境发生变化的时候，只要 UUID 不发生变化，就不需要重连握手，继续传输数据。

拥塞控制:目的是避免过多的数据一下子涌入网络,造成网络超负荷.
QUIC 只需要在应用层进行操作,会根据网络环境,动态选择不同的拥塞控制算法.
向前纠错:根据容错包和数据包,推算出丢失的那个数据.
可以传送更多的 ACK 块(256).

只需要一次握手,后面的连接不需要再去握手
连接过程:

1. 服务器端根据 g 和 p ,生成自己的随机数 a,再把 g 和 p 传送给客户端
2. 客户端收到 g 和 p 之后生成自己的随机数 b,通过 DH 密钥交换算法,客户端和服务器端可以算出同样的密钥.

http3.0 实战:
X5 内核(腾讯开发适合安卓系统的浏览器内核),STGW(腾讯安全云网关)

# https

https 和 http 区别：

1. https 协议要用到 CA(电子身份认证) 申请证书，一般免费证书很少，需要交费
2. http 协议运行在 tcp 之上，传输的内容是明文。https 运行在 SSL/TLS 之上，传输的内容都经过加密。
3. https 可以有效的防止运营商劫持，解决了防劫持的问题
4. 使用完全不同的连接方式，端口也不一样，http 80，https 443

SSL：安全套接字层，处于 OSI 七层网络模型中的的传输安全层，1999 年 被更名为 TLS

TLS 由记录协议，握手协议，警告协议，变更密码规范协议，扩展协议等几个子协议组成，综合使用了对称加密，非对称加密，身份认证等

#　 https 为什么传输更加安全？
http 是明文传输的，所以在传输的过程中，很容易受到第三方的篡改。
https 不是新的协议，是在 http 和 tcp 　之间建立了一个加密的中间层（安全层），利用对称加密和非对称加密结合数字认证证书的方式来进行数据传输，所以更安全。

## 对称加密

对称加密：指的是加密和解密用的相同的密钥（aes,chacha20）
对称加密的缺点在于密钥的传输。中间人可能窃取秘钥，进行解密。

Diffie-Hellman 密钥交换算法可以让双方「心有灵犀一点通」，一定程度解决密钥配送问题，但是无法验证通信方的身份，所以可能受到中间人攻击。

## 非对称加密

非对称加密：Ａ加密过的数据只能用 B 解密，Ｂ加密过的数据只能有 A 解密(RSA,rcdhe)
非对称加密的运算速度比对称加密慢很多，在传输大量数据时，一般不会用公钥直接加密数据，而是把加密对称性加密的密钥，传输给对方，然后双方使用对称性加密算法传输数据。

https 在结合对称加密和非对称加密的基础上，也加入了数字证书认证

## CA 证书：

数字签名可以一定程度上认证数据的来源。
证书= 公钥 + 签名。为了获取这个证书，服务器运营者需要向第三方认证机构获取授权，这个第三方机构也叫 CA(Certificate Authority), 认证通过后 CA 会给服务器颁发数字证书。

证书认证流程：

1. B 向认证机构提供自己的公钥
2. 认证机构对通过私钥对 B 的公钥添加数字签名并生成证书
3. A 检查签名，确认公钥是由这家认证机构发的，没有被篡改
4. A 通过这个公钥加密，开始和 B 通信

证书的作用:

1.  服务器向浏览器证明自己的身份
2.  发送公钥

### http 的协议栈

Http
TCP
IP
数据链路层

# https 是如何让数据传输更加安全的

浏览器和服务器之前传输数据是明文的，这就意味着任何一步都会有中间人来窃取信息

起初是在 Http 和 Tcp 之前建立了一个安全层（SSL/TLS）,所有经过安全层的数据都要经过加密和解密

第一版： 对称加密

- 浏览器向服务器发送对称加密套件列表（浏览器支持的加密方式列表）和 client-random
- 服务器收到后，选择一个对称加密的方式，再把该加密方式和 sever-random 随机数发送给浏览器端
- 这时双方都有了 client-random,server-random,加密方式，然后双方会通过这两个随机数生成一个密钥，来使用该密钥进行加密解密

缺点： 中间人可以获取到传输的随机数以及使用的加密方式，这样就可以通过密钥来伪造数据了

第二版：非对称加密

- 浏览器发送非对称加密套件列表
- 服务器端接收到列表后会，选择一个加密方式和公钥传输给浏览器端
- 浏览器端使用该公钥加密数据，服务端使用自己的私钥解密
- 服务端只能采用私钥加密，浏览器端使用公钥解密

缺点：非对称加密的计算效率太低， 服务器端的数据不安全，中间人还是会拿到公钥来对数据解密

第三版：非对称加密和对称加密的结合

- 浏览器端向服务器端发送加密套件列表，非对称加密套件列表，client-random
- 服务器端向服务器端发送选择后对称和非对称加密的方式，server-random 和公钥
- 浏览器端接收，并生成随机数 per-random ,再利用公钥加密发送给服务器
- 服务器端根据私钥解密 per-random
- 现在双方都有 client-random,server-random,per-random ,然后利用这三个随机数生成密钥进行传输

第四版： 添加数字证书
黑客如果采用 DNS 劫持，将目标地址替换成黑客服务器的地址，然后黑客自己造一份公钥和私钥，照样能进行数据传输。
浏览器要想服务端证明他自己

- 服务器端并不是直接把公钥传给浏览器端，而是返回了数字证书，数字证书里包含了公钥
- 浏览器端需要验证证书的有效性，通过之后才能就行后序传输
